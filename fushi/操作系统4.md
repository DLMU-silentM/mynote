# 操作系统第四章-死锁

## 死锁
多道程序中，由于多个并发进程共享系统的资源，使用不当造成僵局，当某个进程提出请求后，一些进程处于无休止的阻塞状态，在无外力的作用下，这些进程将无法继续进行下去。所有进程处于阻塞态。

> 饥饿：一个进程长期没有被运行。

产生环境：
- 多道程序设计
- 多个并发进程
- 资源共享和独占
- 没有外力借助

产生必要条件
- 资源互斥利用（资源独占）
- 非剥夺控制（不可强占）
- 零散请求
- 循环等待

危害：资源利用率严重下降，甚至系统崩溃

解决方法：
- 鸵鸟法（不处理法）
- 事后处理法
- 积极防御法
  - 预防
    - 破坏互斥条件
    - 破坏不可剥夺条件
    - 破坏零散请求
    - 破坏循环等待 
  - 避免
    - 通过动态选择，在资源分配前，判断是否会发生死锁。
    - 银行家算法：尽可能分配给能拿到资源后完成工作的进程
    - 多项银行家算法：

## 检测和解除

### 资源分配图：描述申请资源和资源分配的关系模型图，表示某个时刻进程对资源的申请和占有情况。
- 圆:一个进程
- 方块：一个资源类
- 资源->进程：资源被分配给进程（for）
- 进程->资源：进程申请资源（from）
- ![20220227212853-2022-02-27-21-28-54](http://lengyuewusheng-blog.oss-cn-beijing.aliyuncs.com/blog/20220227212853-2022-02-27-21-28-54.png)
- 所有节点可以化简为孤立节点，则为可完全化简的，系统不会发生死锁。

### 临时资源：

即可消耗的资源

没有固定数目，不需要释放

表达方式：重定义的资源分配图（箭头的意义是from）
- 圆:一个进程
- 方块：一个资源类
- 进程->资源：进程申请资源，一个箭头只表示申请一个资源
- 资源->进程：资源由进程产生
- 从没有阻塞的进程入手，深处没有阻塞的进程的请求边，并使资源类中资源数-1